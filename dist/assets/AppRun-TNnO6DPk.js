import{aV as Ve,L as U,am as he,b as Ie,l as J,aW as Ee,t as Re,f as X,aX as ye,aY as Ye,aZ as Xe,u as Se,U as Fe,r as k,a_ as Ue,a8 as je,e as y,O as we,n as re,a$ as j,c as le,o as C,w as s,h as o,$ as We,x as S,G as Ce,z as I,A as e,a1 as Ke,y as $,v as A,k as V,ac as qe,E as M,b0 as Ge,av as Q,b1 as Ze,b2 as Je,a as E,B as W,b3 as Qe,b4 as et,C as tt,b5 as at,b6 as st,aw as nt,a5 as ot,ak as F,Y as Ae,a7 as ze,b7 as lt,b8 as rt,ag as it,a2 as ke,a3 as ct,b9 as Te,ba as Le,bb as ut,an as dt,bc as ft,bd as pt,g as Pe,aH as mt,be as gt,q as vt}from"./index-GsB7Yp2N.js";import{E as ht,a as wt}from"./el-col-B8e7pmsu.js";import{d as bt,k as _t,j as yt,f as $e,h as xe,e as Ne}from"./el-table-column-gwx3dvpH.js";import{E as Ct}from"./el-button-Cm60j2Em.js";import{u as Oe}from"./index-INussZ_w.js";import{u as kt}from"./index-ju0VjcdV.js";import"./use-form-common-props-BUWgcdh-.js";import"./event-BB_Ol6Sd.js";var Tt="Expected a function";function ve(t,d,l){var r=!0,c=!0;if(typeof t!="function")throw new TypeError(Tt);return Ve(l)&&(r="leading"in l?!!l.leading:r,c="trailing"in l?!!l.trailing:c),bt(t,d,{leading:r,maxWait:d,trailing:c})}const Lt=(t,d)=>{if(!U||!t||!d)return!1;const l=t.getBoundingClientRect();let r;return d instanceof Element?r=d.getBoundingClientRect():r={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},l.top<r.bottom&&l.bottom>r.top&&l.right>r.left&&l.left<r.right},It=Ie({urlList:{type:J(Array),default:()=>Ee([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:J(String)}}),Et={close:()=>!0,switch:t=>he(t),rotate:t=>he(t)},Rt=X({name:"ElImageViewer"}),St=X({...Rt,props:It,emits:Et,setup(t,{expose:d,emit:l}){var r;const c=t,g={CONTAIN:{name:"contain",icon:ye(Xe)},ORIGINAL:{name:"original",icon:ye(Ye)}};let m,w="";const{t:T}=Oe(),f=Se("image-viewer"),{nextZIndex:u}=Fe(),h=k(),x=k([]),R=Ue(),i=k(!0),L=k(c.initialIndex),b=je(g.CONTAIN),p=k({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ie=k((r=c.zIndex)!=null?r:u()),K=y(()=>{const{urlList:a}=c;return a.length<=1}),ee=y(()=>L.value===0),q=y(()=>L.value===c.urlList.length-1),G=y(()=>c.urlList[L.value]),ce=y(()=>[f.e("btn"),f.e("prev"),f.is("disabled",!c.infinite&&ee.value)]),ue=y(()=>[f.e("btn"),f.e("next"),f.is("disabled",!c.infinite&&q.value)]),te=y(()=>{const{scale:a,deg:_,offsetX:v,offsetY:P,enableTransition:O}=p.value;let D=v/a,B=P/a;const Z=_*Math.PI/180,be=Math.cos(Z),_e=Math.sin(Z);D=D*be+B*_e,B=B*be-v/a*_e;const ge={transform:`scale(${a}) rotate(${_}deg) translate(${D}px, ${B}px)`,transition:O?"transform .3s":""};return b.value.name===g.CONTAIN.name&&(ge.maxWidth=ge.maxHeight="100%"),ge}),ae=y(()=>`${L.value+1} / ${c.urlList.length}`);function Y(){ne(),m?.(),document.body.style.overflow=w,l("close")}function se(){const a=ve(v=>{switch(v.code){case F.esc:c.closeOnPressEscape&&Y();break;case F.space:N();break;case F.left:pe();break;case F.up:H("zoomIn");break;case F.right:me();break;case F.down:H("zoomOut");break}}),_=ve(v=>{const P=v.deltaY||v.deltaX;H(P<0?"zoomIn":"zoomOut",{zoomRate:c.zoomRate,enableTransition:!1})});R.run(()=>{j(document,"keydown",a),j(document,"wheel",_)})}function ne(){R.stop()}function de(){i.value=!1}function fe(a){i.value=!1,a.target.alt=T("el.image.error")}function n(a){if(i.value||a.button!==0||!h.value)return;p.value.enableTransition=!1;const{offsetX:_,offsetY:v}=p.value,P=a.pageX,O=a.pageY,D=ve(Z=>{p.value={...p.value,offsetX:_+Z.pageX-P,offsetY:v+Z.pageY-O}}),B=j(document,"mousemove",D);j(document,"mouseup",()=>{B()}),a.preventDefault()}function z(){p.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function N(){if(i.value)return;const a=_t(g),_=Object.values(g),v=b.value.name,O=(_.findIndex(D=>D.name===v)+1)%a.length;b.value=g[a[O]],z()}function oe(a){const _=c.urlList.length;L.value=(a+_)%_}function pe(){ee.value&&!c.infinite||oe(L.value-1)}function me(){q.value&&!c.infinite||oe(L.value+1)}function H(a,_={}){if(i.value)return;const{minScale:v,maxScale:P}=c,{zoomRate:O,rotateDeg:D,enableTransition:B}={zoomRate:c.zoomRate,rotateDeg:90,enableTransition:!0,..._};switch(a){case"zoomOut":p.value.scale>v&&(p.value.scale=Number.parseFloat((p.value.scale/O).toFixed(3)));break;case"zoomIn":p.value.scale<P&&(p.value.scale=Number.parseFloat((p.value.scale*O).toFixed(3)));break;case"clockwise":p.value.deg+=D,l("rotate",p.value.deg);break;case"anticlockwise":p.value.deg-=D,l("rotate",p.value.deg);break}p.value.enableTransition=B}function He(a){var _;((_=a.detail)==null?void 0:_.focusReason)==="pointer"&&a.preventDefault()}function Be(){c.closeOnPressEscape&&Y()}function Me(a){if(a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}return we(G,()=>{Ae(()=>{const a=x.value[0];a?.complete||(i.value=!0)})}),we(L,a=>{z(),l("switch",a)}),re(()=>{se(),m=j("wheel",Me,{passive:!1}),w=document.body.style.overflow,document.body.style.overflow="hidden"}),d({setActiveItem:oe}),(a,_)=>(C(),le(e(ot),{to:"body",disabled:!a.teleported},{default:s(()=>[o(We,{name:"viewer-fade",appear:""},{default:s(()=>[S("div",{ref_key:"wrapper",ref:h,tabindex:-1,class:I(e(f).e("wrapper")),style:Ce({zIndex:ie.value})},[o(e(Ke),{loop:"",trapped:"","focus-trap-el":h.value,"focus-start-el":"container",onFocusoutPrevented:He,onReleaseRequested:Be},{default:s(()=>[S("div",{class:I(e(f).e("mask")),onClick:qe(v=>a.hideOnClickModal&&Y(),["self"])},null,10,["onClick"]),$(" CLOSE "),S("span",{class:I([e(f).e("btn"),e(f).e("close")]),onClick:Y},[o(e(M),null,{default:s(()=>[o(e(Ge))]),_:1})],2),$(" ARROW "),e(K)?$("v-if",!0):(C(),A(Q,{key:0},[S("span",{class:I(e(ce)),onClick:pe},[o(e(M),null,{default:s(()=>[o(e(Ze))]),_:1})],2),S("span",{class:I(e(ue)),onClick:me},[o(e(M),null,{default:s(()=>[o(e(Je))]),_:1})],2)],64)),a.$slots.progress||a.showProgress?(C(),A("div",{key:1,class:I([e(f).e("btn"),e(f).e("progress")])},[V(a.$slots,"progress",{activeIndex:L.value,total:a.urlList.length},()=>[E(W(e(ae)),1)])],2)):$("v-if",!0),$(" ACTIONS "),S("div",{class:I([e(f).e("btn"),e(f).e("actions")])},[S("div",{class:I(e(f).e("actions__inner"))},[V(a.$slots,"toolbar",{actions:H,prev:pe,next:me,reset:N,activeIndex:L.value,setActiveItem:oe},()=>[o(e(M),{onClick:v=>H("zoomOut")},{default:s(()=>[o(e(Qe))]),_:1},8,["onClick"]),o(e(M),{onClick:v=>H("zoomIn")},{default:s(()=>[o(e(et))]),_:1},8,["onClick"]),S("i",{class:I(e(f).e("actions__divider"))},null,2),o(e(M),{onClick:N},{default:s(()=>[(C(),le(tt(e(b).icon)))]),_:1}),S("i",{class:I(e(f).e("actions__divider"))},null,2),o(e(M),{onClick:v=>H("anticlockwise")},{default:s(()=>[o(e(at))]),_:1},8,["onClick"]),o(e(M),{onClick:v=>H("clockwise")},{default:s(()=>[o(e(st))]),_:1},8,["onClick"])])],2)],2),$(" CANVAS "),S("div",{class:I(e(f).e("canvas"))},[(C(!0),A(Q,null,nt(a.urlList,(v,P)=>(C(),A(Q,{key:P},[P===L.value?(C(),A("img",{key:0,ref_for:!0,ref:O=>x.value[P]=O,src:v,style:Ce(e(te)),class:I(e(f).e("img")),crossorigin:a.crossorigin,onLoad:de,onError:fe,onMousedown:n},null,46,["src","crossorigin"])):$("v-if",!0)],64))),128))],2),V(a.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var At=Re(St,[["__file","image-viewer.vue"]]);const zt=ze(At),Pt=Ie({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:J([String,Object])},previewSrcList:{type:J(Array),default:()=>Ee([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:J(String)}}),$t={load:t=>t instanceof Event,error:t=>t instanceof Event,switch:t=>he(t),close:()=>!0,show:()=>!0},xt=X({name:"ElImage",inheritAttrs:!1}),Nt=X({...xt,props:Pt,emits:$t,setup(t,{expose:d,emit:l}){const r=t,{t:c}=Oe(),g=Se("image"),m=lt(),w=y(()=>rt(Object.entries(m).filter(([n])=>/^(data-|on[A-Z])/i.test(n)||["id","style"].includes(n)))),T=kt({excludeListeners:!0,excludeKeys:y(()=>Object.keys(w.value))}),f=k(),u=k(!1),h=k(!0),x=k(!1),R=k(),i=k(),L=U&&"loading"in HTMLImageElement.prototype;let b;const p=y(()=>[g.e("inner"),K.value&&g.e("preview"),h.value&&g.is("loading")]),ie=y(()=>{const{fit:n}=r;return U&&n?{objectFit:n}:{}}),K=y(()=>{const{previewSrcList:n}=r;return it(n)&&n.length>0}),ee=y(()=>{const{previewSrcList:n,initialIndex:z}=r;let N=z;return z>n.length-1&&(N=0),N}),q=y(()=>r.loading==="eager"?!1:!L&&r.loading==="lazy"||r.lazy),G=()=>{U&&(h.value=!0,u.value=!1,f.value=r.src)};function ce(n){h.value=!1,u.value=!1,l("load",n)}function ue(n){h.value=!1,u.value=!0,l("error",n)}function te(){Lt(R.value,i.value)&&(G(),se())}const ae=ft(te,200,!0);async function Y(){var n;if(!U)return;await Ae();const{scrollContainer:z}=r;ut(z)?i.value=z:dt(z)&&z!==""?i.value=(n=document.querySelector(z))!=null?n:void 0:R.value&&(i.value=yt(R.value)),i.value&&(b=j(i,"scroll",ae),setTimeout(()=>te(),100))}function se(){!U||!i.value||!ae||(b?.(),i.value=void 0)}function ne(){K.value&&(x.value=!0,l("show"))}function de(){x.value=!1,l("close")}function fe(n){l("switch",n)}return we(()=>r.src,()=>{q.value?(h.value=!0,u.value=!1,se(),Y()):G()}),re(()=>{q.value?Y():G()}),d({showPreview:ne}),(n,z)=>(C(),A("div",ke({ref_key:"container",ref:R},e(w),{class:[e(g).b(),n.$attrs.class]}),[u.value?V(n.$slots,"error",{key:0},()=>[S("div",{class:I(e(g).e("error"))},W(e(c)("el.image.error")),3)]):(C(),A(Q,{key:1},[f.value!==void 0?(C(),A("img",ke({key:0},e(T),{src:f.value,loading:n.loading,style:e(ie),class:e(p),crossorigin:n.crossorigin,onClick:ne,onLoad:ce,onError:ue}),null,16,["src","loading","crossorigin"])):$("v-if",!0),h.value?(C(),A("div",{key:1,class:I(e(g).e("wrapper"))},[V(n.$slots,"placeholder",{},()=>[S("div",{class:I(e(g).e("placeholder"))},null,2)])],2)):$("v-if",!0)],64)),e(K)?(C(),A(Q,{key:2},[x.value?(C(),le(e(zt),{key:0,"z-index":n.zIndex,"initial-index":e(ee),infinite:n.infinite,"zoom-rate":n.zoomRate,"min-scale":n.minScale,"max-scale":n.maxScale,"show-progress":n.showProgress,"url-list":n.previewSrcList,crossorigin:n.crossorigin,"hide-on-click-modal":n.hideOnClickModal,teleported:n.previewTeleported,"close-on-press-escape":n.closeOnPressEscape,onClose:de,onSwitch:fe},ct({toolbar:s(N=>[V(n.$slots,"toolbar",Te(Le(N)))]),default:s(()=>[n.$slots.viewer?(C(),A("div",{key:0},[V(n.$slots,"viewer")])):$("v-if",!0)]),_:2},[n.$slots.progress?{name:"progress",fn:s(N=>[V(n.$slots,"progress",Te(Le(N)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):$("v-if",!0)],64)):$("v-if",!0)],16))}});var Ot=Re(Nt,[["__file","image.vue"]]);const Dt=ze(Ot),De=pt("scriptDataStore",{state:()=>({characterTables:[],logsList:[]}),getters:{getCharacterTables(t){return t.characterTables},getLogsList(t){return t.logsList}},actions:{async updateCharacterTables(t){if(t.hwnd===void 0)return;const d=this.characterTables.findIndex(l=>l.hwnd===t.hwnd);d!==-1&&(t.character&&(this.characterTables[d].character=t.character),t.state&&(this.characterTables[d].state=t.state))},async addCharacterTables(t){this.characterTables.push(t)},async deleteCharacterTables(t){const d=this.characterTables.findIndex(l=>l.hwnd===t);d!==-1&&this.characterTables.splice(d,1)},async updateLogsList(t){this.logsList.unshift(t),this.logsList.length=Math.min(this.logsList.length,1e3)}},persist:{storage:sessionStorage}});function Ht(){const{appContext:t}=Pe(),d=k(),l=k(0),r=mt(),c=De(),g=y(()=>c.getCharacterTables),m=async()=>{window.pywebview.api.emit("API:SCRIPT:START",r.getTaskConfig)},w=async i=>{window.pywebview.api.emit("API:SCRIPT:UNBIND",i.hwnd),await c.deleteCharacterTables(i.hwnd)},T=async i=>{window.pywebview.api.emit("API:SCRIPT:STOP",i.hwnd)},f=async i=>{window.pywebview.api.emit("API:SCRIPT:RESUME",i.hwnd)},u=async i=>{window.pywebview.api.emit("API:SCRIPT:SCREENSHOT",i.hwnd)},h=()=>{if(d.value){const i=d.value.clientHeight;l.value=i-10}},x=async i=>{await c.updateCharacterTables(i)},R=async i=>{await c.addCharacterTables(i)};return re(()=>{console.log("useCharacterTable mounted"),h(),window.addEventListener("resize",h),t.config.globalProperties.$mitt.on("API:UPDATE:CHARACTER",x),t.config.globalProperties.$mitt.on("API:ADD:CHARACTER",R)}),gt(()=>{console.log("useCharacterTable unmounted"),window.removeEventListener("resize",h),t.config.globalProperties.$mitt.off("API:UPDATE:CHARACTER",x),t.config.globalProperties.$mitt.off("API:ADD:CHARACTER",R)}),{characterTables:g,tableRef:d,tableHeight:l,start:m,unbind:w,stop:T,resume:f,screenshot:u}}const Bt=X({__name:"CharacterTable",setup(t){const{characterTables:d,tableRef:l,tableHeight:r,start:c,unbind:g,stop:m,resume:w,screenshot:T}=Ht();return(f,u)=>{const h=Ne,x=Dt,R=xe,i=Ct,L=$e;return C(),A("div",{class:"h-100%",ref_key:"tableRef",ref:l},[o(L,{"highlight-current-row":"",height:e(r),data:e(d)},{empty:s(()=>u[0]||(u[0]=[S("span",null,null,-1)])),default:s(()=>[o(R,{width:"130",label:"角色信息"},{header:s(()=>[o(h,null,{default:s(()=>u[1]||(u[1]=[E("角色信息")])),_:1,__:[1]})]),default:s(b=>[o(x,{fit:"contain",src:b.row.character},null,8,["src"])]),_:1}),o(R,{width:"100",label:"任务状态"},{header:s(()=>[o(h,null,{default:s(()=>u[2]||(u[2]=[E("任务状态")])),_:1,__:[2]})]),default:s(b=>[o(h,null,{default:s(()=>[E(W(b.row.state),1)]),_:2},1024)]),_:1}),o(R,{fixed:"right","min-width":"280",label:"操作"},{header:s(()=>[o(i,{onClick:e(c),size:"small",type:"success"},{default:s(()=>u[3]||(u[3]=[E("开始")])),_:1,__:[3]},8,["onClick"])]),default:s(b=>[o(i,{onClick:p=>e(m)(b.row),size:"small"},{default:s(()=>u[4]||(u[4]=[E("暂停")])),_:2,__:[4]},1032,["onClick"]),o(i,{onClick:p=>e(w)(b.row),size:"small"},{default:s(()=>u[5]||(u[5]=[E("恢复")])),_:2,__:[5]},1032,["onClick"]),o(i,{onClick:p=>e(g)(b.row),size:"small"},{default:s(()=>u[6]||(u[6]=[E("解绑")])),_:2,__:[6]},1032,["onClick"]),o(i,{onClick:p=>e(T)(b.row),size:"small"},{default:s(()=>u[7]||(u[7]=[E("截图")])),_:2,__:[7]},1032,["onClick"])]),_:1})]),_:1},8,["height","data"])],512)}}});function Mt(){const t=De(),d=y(()=>t.getLogsList),{appContext:l}=Pe(),r=k(),c=k(),g=k(0),m=async T=>{await t.updateLogsList(T)},w=()=>{if(r.value){const T=r.value.clientHeight;g.value=T-10}};return re(()=>{w(),window.addEventListener("resize",w),l.config.globalProperties.$mitt.on("API:ADD:LOGS",m)}),vt(()=>{window.removeEventListener("resize",w),l.config.globalProperties.$mitt.off("API:ADD:LOGS",m)}),{logList:d,tableRef:r,logTableRef:c,tableHeight:g,addLog:m}}const Vt=X({__name:"AppLogs",setup(t){const{logList:d,tableHeight:l,tableRef:r,logTableRef:c}=Mt();return(g,m)=>{const w=Ne,T=xe,f=$e;return C(),A("div",{class:"h-100%",ref_key:"tableRef",ref:r},[o(f,{ref_key:"logTableRef",ref:c,data:e(d),height:e(l)},{empty:s(()=>m[0]||(m[0]=[S("span",null,null,-1)])),default:s(()=>[o(T,{width:"180"},{header:s(()=>[o(w,null,{default:s(()=>m[1]||(m[1]=[E("时间")])),_:1,__:[1]})]),default:s(u=>[E(W(u.row.time),1)]),_:1}),o(T,{width:"80"},{header:s(()=>[o(w,null,{default:s(()=>m[2]||(m[2]=[E("等级")])),_:1,__:[2]})]),default:s(u=>[E(W(u.row.info),1)]),_:1}),o(T,{"min-width":"150",fixed:"right"},{header:s(()=>[o(w,null,{default:s(()=>m[3]||(m[3]=[E("内容")])),_:1,__:[3]})]),default:s(u=>[E(W(u.row.data),1)]),_:1})]),_:1},8,["data","height"])],512)}}}),Gt=X({__name:"AppRun",setup(t){return(d,l)=>{const r=wt,c=ht;return C(),le(c,{class:"h-100%"},{default:s(()=>[o(r,{class:"h-100%",span:14},{default:s(()=>[o(Bt)]),_:1}),o(r,{span:10},{default:s(()=>[o(Vt)]),_:1})]),_:1})}}});export{Gt as default};
