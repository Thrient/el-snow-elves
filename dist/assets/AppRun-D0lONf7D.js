import{aD as Fe,R as j,S as he,b as Le,X as J,an as Ee,k as Re,l as X,aE as ye,aF as Xe,aG as Ye,y as Se,aH as je,r as k,aI as Ke,s as Ue,e as y,j as we,J as re,aB as K,c as le,o as C,w as s,a3 as o,aJ as We,F as S,I as Ce,x as L,A as e,aK as Ge,H as $,n as A,p as V,q as qe,ab as M,aL as Ze,a4 as Q,aM as Je,aN as Qe,a as E,G as U,aO as et,aP as tt,a8 as at,aQ as st,aR as nt,a5 as ot,aS as lt,P as Y,E as Ae,ai as ze,ao as rt,aT as it,K as ct,au as ke,aA as ut,aU as Te,aV as Ie,aW as dt,T as ft,aX as pt,aY as gt,g as Pe,D as $e}from"./index-FRVguIct.js";import{u as mt,E as vt,a as ht}from"./el-col-DuGw8man.js";import{d as wt,k as bt,h as _t,f as xe,g as Ne,e as Oe}from"./el-table-column-D6xMWYhp.js";import{E as yt}from"./el-button-tMPUpgZ7.js";import{u as De,a as Ct}from"./task-config-FSChBe8a.js";import"./use-form-common-props-AxxbEoG-.js";var kt="Expected a function";function ve(t,d,l){var r=!0,c=!0;if(typeof t!="function")throw new TypeError(kt);return Fe(l)&&(r="leading"in l?!!l.leading:r,c="trailing"in l?!!l.trailing:c),wt(t,d,{leading:r,maxWait:d,trailing:c})}const Tt=(t,d)=>{if(!j||!t||!d)return!1;const l=t.getBoundingClientRect();let r;return d instanceof Element?r=d.getBoundingClientRect():r={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},l.top<r.bottom&&l.bottom>r.top&&l.right>r.left&&l.left<r.right},It=Le({urlList:{type:J(Array),default:()=>Ee([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:J(String)}}),Lt={close:()=>!0,switch:t=>he(t),rotate:t=>he(t)},Et=X({name:"ElImageViewer"}),Rt=X({...Et,props:It,emits:Lt,setup(t,{expose:d,emit:l}){var r;const c=t,m={CONTAIN:{name:"contain",icon:ye(Ye)},ORIGINAL:{name:"original",icon:ye(Xe)}};let g,w="";const{t:T}=De(),f=Se("image-viewer"),{nextZIndex:u}=je(),h=k(),x=k([]),R=Ke(),i=k(!0),I=k(c.initialIndex),b=Ue(m.CONTAIN),p=k({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ie=k((r=c.zIndex)!=null?r:u()),W=y(()=>{const{urlList:a}=c;return a.length<=1}),ee=y(()=>I.value===0),G=y(()=>I.value===c.urlList.length-1),q=y(()=>c.urlList[I.value]),ce=y(()=>[f.e("btn"),f.e("prev"),f.is("disabled",!c.infinite&&ee.value)]),ue=y(()=>[f.e("btn"),f.e("next"),f.is("disabled",!c.infinite&&G.value)]),te=y(()=>{const{scale:a,deg:_,offsetX:v,offsetY:P,enableTransition:O}=p.value;let D=v/a,B=P/a;const Z=_*Math.PI/180,be=Math.cos(Z),_e=Math.sin(Z);D=D*be+B*_e,B=B*be-v/a*_e;const me={transform:`scale(${a}) rotate(${_}deg) translate(${D}px, ${B}px)`,transition:O?"transform .3s":""};return b.value.name===m.CONTAIN.name&&(me.maxWidth=me.maxHeight="100%"),me}),ae=y(()=>`${I.value+1} / ${c.urlList.length}`);function F(){ne(),g?.(),document.body.style.overflow=w,l("close")}function se(){const a=ve(v=>{switch(v.code){case Y.esc:c.closeOnPressEscape&&F();break;case Y.space:N();break;case Y.left:pe();break;case Y.up:H("zoomIn");break;case Y.right:ge();break;case Y.down:H("zoomOut");break}}),_=ve(v=>{const P=v.deltaY||v.deltaX;H(P<0?"zoomIn":"zoomOut",{zoomRate:c.zoomRate,enableTransition:!1})});R.run(()=>{K(document,"keydown",a),K(document,"wheel",_)})}function ne(){R.stop()}function de(){i.value=!1}function fe(a){i.value=!1,a.target.alt=T("el.image.error")}function n(a){if(i.value||a.button!==0||!h.value)return;p.value.enableTransition=!1;const{offsetX:_,offsetY:v}=p.value,P=a.pageX,O=a.pageY,D=ve(Z=>{p.value={...p.value,offsetX:_+Z.pageX-P,offsetY:v+Z.pageY-O}}),B=K(document,"mousemove",D);K(document,"mouseup",()=>{B()}),a.preventDefault()}function z(){p.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function N(){if(i.value)return;const a=bt(m),_=Object.values(m),v=b.value.name,O=(_.findIndex(D=>D.name===v)+1)%a.length;b.value=m[a[O]],z()}function oe(a){const _=c.urlList.length;I.value=(a+_)%_}function pe(){ee.value&&!c.infinite||oe(I.value-1)}function ge(){G.value&&!c.infinite||oe(I.value+1)}function H(a,_={}){if(i.value)return;const{minScale:v,maxScale:P}=c,{zoomRate:O,rotateDeg:D,enableTransition:B}={zoomRate:c.zoomRate,rotateDeg:90,enableTransition:!0,..._};switch(a){case"zoomOut":p.value.scale>v&&(p.value.scale=Number.parseFloat((p.value.scale/O).toFixed(3)));break;case"zoomIn":p.value.scale<P&&(p.value.scale=Number.parseFloat((p.value.scale*O).toFixed(3)));break;case"clockwise":p.value.deg+=D,l("rotate",p.value.deg);break;case"anticlockwise":p.value.deg-=D,l("rotate",p.value.deg);break}p.value.enableTransition=B}function Be(a){var _;((_=a.detail)==null?void 0:_.focusReason)==="pointer"&&a.preventDefault()}function Me(){c.closeOnPressEscape&&F()}function Ve(a){if(a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}return we(q,()=>{Ae(()=>{const a=x.value[0];a?.complete||(i.value=!0)})}),we(I,a=>{z(),l("switch",a)}),re(()=>{se(),g=K("wheel",Ve,{passive:!1}),w=document.body.style.overflow,document.body.style.overflow="hidden"}),d({setActiveItem:oe}),(a,_)=>(C(),le(e(lt),{to:"body",disabled:!a.teleported},{default:s(()=>[o(We,{name:"viewer-fade",appear:""},{default:s(()=>[S("div",{ref_key:"wrapper",ref:h,tabindex:-1,class:L(e(f).e("wrapper")),style:Ce({zIndex:ie.value})},[o(e(Ge),{loop:"",trapped:"","focus-trap-el":h.value,"focus-start-el":"container",onFocusoutPrevented:Be,onReleaseRequested:Me},{default:s(()=>[S("div",{class:L(e(f).e("mask")),onClick:qe(v=>a.hideOnClickModal&&F(),["self"])},null,10,["onClick"]),$(" CLOSE "),S("span",{class:L([e(f).e("btn"),e(f).e("close")]),onClick:F},[o(e(M),null,{default:s(()=>[o(e(Ze))]),_:1})],2),$(" ARROW "),e(W)?$("v-if",!0):(C(),A(Q,{key:0},[S("span",{class:L(e(ce)),onClick:pe},[o(e(M),null,{default:s(()=>[o(e(Je))]),_:1})],2),S("span",{class:L(e(ue)),onClick:ge},[o(e(M),null,{default:s(()=>[o(e(Qe))]),_:1})],2)],64)),a.$slots.progress||a.showProgress?(C(),A("div",{key:1,class:L([e(f).e("btn"),e(f).e("progress")])},[V(a.$slots,"progress",{activeIndex:I.value,total:a.urlList.length},()=>[E(U(e(ae)),1)])],2)):$("v-if",!0),$(" ACTIONS "),S("div",{class:L([e(f).e("btn"),e(f).e("actions")])},[S("div",{class:L(e(f).e("actions__inner"))},[V(a.$slots,"toolbar",{actions:H,prev:pe,next:ge,reset:N,activeIndex:I.value,setActiveItem:oe},()=>[o(e(M),{onClick:v=>H("zoomOut")},{default:s(()=>[o(e(et))]),_:1},8,["onClick"]),o(e(M),{onClick:v=>H("zoomIn")},{default:s(()=>[o(e(tt))]),_:1},8,["onClick"]),S("i",{class:L(e(f).e("actions__divider"))},null,2),o(e(M),{onClick:N},{default:s(()=>[(C(),le(at(e(b).icon)))]),_:1}),S("i",{class:L(e(f).e("actions__divider"))},null,2),o(e(M),{onClick:v=>H("anticlockwise")},{default:s(()=>[o(e(st))]),_:1},8,["onClick"]),o(e(M),{onClick:v=>H("clockwise")},{default:s(()=>[o(e(nt))]),_:1},8,["onClick"])])],2)],2),$(" CANVAS "),S("div",{class:L(e(f).e("canvas"))},[(C(!0),A(Q,null,ot(a.urlList,(v,P)=>(C(),A(Q,{key:P},[P===I.value?(C(),A("img",{key:0,ref_for:!0,ref:O=>x.value[P]=O,src:v,style:Ce(e(te)),class:L(e(f).e("img")),crossorigin:a.crossorigin,onLoad:de,onError:fe,onMousedown:n},null,46,["src","crossorigin"])):$("v-if",!0)],64))),128))],2),V(a.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var St=Re(Rt,[["__file","image-viewer.vue"]]);const At=ze(St),zt=Le({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:J([String,Object])},previewSrcList:{type:J(Array),default:()=>Ee([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:J(String)}}),Pt={load:t=>t instanceof Event,error:t=>t instanceof Event,switch:t=>he(t),close:()=>!0,show:()=>!0},$t=X({name:"ElImage",inheritAttrs:!1}),xt=X({...$t,props:zt,emits:Pt,setup(t,{expose:d,emit:l}){const r=t,{t:c}=De(),m=Se("image"),g=rt(),w=y(()=>it(Object.entries(g).filter(([n])=>/^(data-|on[A-Z])/i.test(n)||["id","style"].includes(n)))),T=mt({excludeListeners:!0,excludeKeys:y(()=>Object.keys(w.value))}),f=k(),u=k(!1),h=k(!0),x=k(!1),R=k(),i=k(),I=j&&"loading"in HTMLImageElement.prototype;let b;const p=y(()=>[m.e("inner"),W.value&&m.e("preview"),h.value&&m.is("loading")]),ie=y(()=>{const{fit:n}=r;return j&&n?{objectFit:n}:{}}),W=y(()=>{const{previewSrcList:n}=r;return ct(n)&&n.length>0}),ee=y(()=>{const{previewSrcList:n,initialIndex:z}=r;let N=z;return z>n.length-1&&(N=0),N}),G=y(()=>r.loading==="eager"?!1:!I&&r.loading==="lazy"||r.lazy),q=()=>{j&&(h.value=!0,u.value=!1,f.value=r.src)};function ce(n){h.value=!1,u.value=!1,l("load",n)}function ue(n){h.value=!1,u.value=!0,l("error",n)}function te(){Tt(R.value,i.value)&&(q(),se())}const ae=pt(te,200,!0);async function F(){var n;if(!j)return;await Ae();const{scrollContainer:z}=r;dt(z)?i.value=z:ft(z)&&z!==""?i.value=(n=document.querySelector(z))!=null?n:void 0:R.value&&(i.value=_t(R.value)),i.value&&(b=K(i,"scroll",ae),setTimeout(()=>te(),100))}function se(){!j||!i.value||!ae||(b?.(),i.value=void 0)}function ne(){W.value&&(x.value=!0,l("show"))}function de(){x.value=!1,l("close")}function fe(n){l("switch",n)}return we(()=>r.src,()=>{G.value?(h.value=!0,u.value=!1,se(),F()):q()}),re(()=>{G.value?F():q()}),d({showPreview:ne}),(n,z)=>(C(),A("div",ke({ref_key:"container",ref:R},e(w),{class:[e(m).b(),n.$attrs.class]}),[u.value?V(n.$slots,"error",{key:0},()=>[S("div",{class:L(e(m).e("error"))},U(e(c)("el.image.error")),3)]):(C(),A(Q,{key:1},[f.value!==void 0?(C(),A("img",ke({key:0},e(T),{src:f.value,loading:n.loading,style:e(ie),class:e(p),crossorigin:n.crossorigin,onClick:ne,onLoad:ce,onError:ue}),null,16,["src","loading","crossorigin"])):$("v-if",!0),h.value?(C(),A("div",{key:1,class:L(e(m).e("wrapper"))},[V(n.$slots,"placeholder",{},()=>[S("div",{class:L(e(m).e("placeholder"))},null,2)])],2)):$("v-if",!0)],64)),e(W)?(C(),A(Q,{key:2},[x.value?(C(),le(e(At),{key:0,"z-index":n.zIndex,"initial-index":e(ee),infinite:n.infinite,"zoom-rate":n.zoomRate,"min-scale":n.minScale,"max-scale":n.maxScale,"show-progress":n.showProgress,"url-list":n.previewSrcList,crossorigin:n.crossorigin,"hide-on-click-modal":n.hideOnClickModal,teleported:n.previewTeleported,"close-on-press-escape":n.closeOnPressEscape,onClose:de,onSwitch:fe},ut({toolbar:s(N=>[V(n.$slots,"toolbar",Te(Ie(N)))]),default:s(()=>[n.$slots.viewer?(C(),A("div",{key:0},[V(n.$slots,"viewer")])):$("v-if",!0)]),_:2},[n.$slots.progress?{name:"progress",fn:s(N=>[V(n.$slots,"progress",Te(Ie(N)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):$("v-if",!0)],64)):$("v-if",!0)],16))}});var Nt=Re(xt,[["__file","image.vue"]]);const Ot=ze(Nt),He=gt("scriptData",{state:()=>({characterTables:[],logsList:[]}),getters:{getCharacterTables(t){return t.characterTables},getLogsList(t){return t.logsList}},actions:{async updateCharacterTables(t){if(t.hwnd===void 0)return;const d=this.characterTables.findIndex(l=>l.hwnd===t.hwnd);d!==-1&&(t.character&&(this.characterTables[d].character=t.character),t.state&&(this.characterTables[d].state=t.state))},async addCharacterTables(t){this.characterTables.push(t)},async deleteCharacterTables(t){const d=this.characterTables.findIndex(l=>l.hwnd===t);d!==-1&&this.characterTables.splice(d,1)},async updateLogsList(t){this.logsList.unshift(t),this.logsList.length=Math.min(this.logsList.length,1e3)}},persist:{storage:sessionStorage}});function Dt(){const{appContext:t}=Pe(),d=k(),l=k(0),r=Ct(),c=He(),m=y(()=>c.getCharacterTables),g=async()=>{window.pywebview.api.emit("API:SCRIPT:START",r.getTaskConfig)},w=async i=>{window.pywebview.api.emit("API:SCRIPT:UNBIND",i.hwnd),await c.deleteCharacterTables(i.hwnd)},T=async i=>{window.pywebview.api.emit("API:SCRIPT:STOP",i.hwnd)},f=async i=>{window.pywebview.api.emit("API:SCRIPT:RESUME",i.hwnd)},u=async i=>{window.pywebview.api.emit("API:SCRIPT:SCREENSHOT",i.hwnd)},h=()=>{if(d.value){const i=d.value.clientHeight;l.value=i-10}},x=async i=>{await c.updateCharacterTables(i)},R=async i=>{await c.addCharacterTables(i)};return re(()=>{h(),window.addEventListener("resize",h),t.config.globalProperties.$mitt.on("API:UPDATE:CHARACTER",x),t.config.globalProperties.$mitt.on("API:ADD:CHARACTER",R)}),$e(()=>{window.removeEventListener("resize",h),t.config.globalProperties.$mitt.off("API:UPDATE:CHARACTER",x),t.config.globalProperties.$mitt.off("API:ADD:CHARACTER",R)}),{characterTables:m,tableRef:d,tableHeight:l,start:g,unbind:w,stop:T,resume:f,screenshot:u}}const Ht=X({__name:"CharacterTable",setup(t){const{characterTables:d,tableRef:l,tableHeight:r,start:c,unbind:m,stop:g,resume:w,screenshot:T}=Dt();return(f,u)=>{const h=Oe,x=Ot,R=Ne,i=yt,I=xe;return C(),A("div",{class:"h-100%",ref_key:"tableRef",ref:l},[o(I,{"highlight-current-row":"",height:e(r),data:e(d)},{empty:s(()=>u[0]||(u[0]=[S("span",null,null,-1)])),default:s(()=>[o(R,{width:"130",label:"角色信息"},{header:s(()=>[o(h,null,{default:s(()=>u[1]||(u[1]=[E("角色信息")])),_:1,__:[1]})]),default:s(b=>[o(x,{fit:"contain",src:b.row.character},null,8,["src"])]),_:1}),o(R,{width:"100",label:"任务状态"},{header:s(()=>[o(h,null,{default:s(()=>u[2]||(u[2]=[E("任务状态")])),_:1,__:[2]})]),default:s(b=>[o(h,null,{default:s(()=>[E(U(b.row.state),1)]),_:2},1024)]),_:1}),o(R,{fixed:"right","min-width":"280",label:"操作"},{header:s(()=>[o(i,{onClick:e(c),size:"small",type:"success"},{default:s(()=>u[3]||(u[3]=[E("开始")])),_:1,__:[3]},8,["onClick"])]),default:s(b=>[o(i,{onClick:p=>e(g)(b.row),size:"small"},{default:s(()=>u[4]||(u[4]=[E("暂停")])),_:2,__:[4]},1032,["onClick"]),o(i,{onClick:p=>e(w)(b.row),size:"small"},{default:s(()=>u[5]||(u[5]=[E("恢复")])),_:2,__:[5]},1032,["onClick"]),o(i,{onClick:p=>e(m)(b.row),size:"small"},{default:s(()=>u[6]||(u[6]=[E("解绑")])),_:2,__:[6]},1032,["onClick"]),o(i,{onClick:p=>e(T)(b.row),size:"small"},{default:s(()=>u[7]||(u[7]=[E("截图")])),_:2,__:[7]},1032,["onClick"])]),_:1})]),_:1},8,["height","data"])],512)}}});function Bt(){const t=He(),d=y(()=>t.getLogsList),{appContext:l}=Pe(),r=k(),c=k(),m=k(0),g=async T=>{await t.updateLogsList(T)},w=()=>{if(r.value){const T=r.value.clientHeight;m.value=T-10}};return re(()=>{w(),window.addEventListener("resize",w),l.config.globalProperties.$mitt.on("API:ADD:LOGS",g)}),$e(()=>{window.removeEventListener("resize",w),l.config.globalProperties.$mitt.off("API:ADD:LOGS",g)}),{logList:d,tableRef:r,logTableRef:c,tableHeight:m,addLog:g}}const Mt=X({__name:"AppLogs",setup(t){const{logList:d,tableHeight:l,tableRef:r,logTableRef:c}=Bt();return(m,g)=>{const w=Oe,T=Ne,f=xe;return C(),A("div",{class:"h-100%",ref_key:"tableRef",ref:r},[o(f,{ref_key:"logTableRef",ref:c,data:e(d),height:e(l)},{empty:s(()=>g[0]||(g[0]=[S("span",null,null,-1)])),default:s(()=>[o(T,{width:"180"},{header:s(()=>[o(w,null,{default:s(()=>g[1]||(g[1]=[E("时间")])),_:1,__:[1]})]),default:s(u=>[E(U(u.row.time),1)]),_:1}),o(T,{width:"80"},{header:s(()=>[o(w,null,{default:s(()=>g[2]||(g[2]=[E("等级")])),_:1,__:[2]})]),default:s(u=>[E(U(u.row.info),1)]),_:1}),o(T,{"min-width":"150",fixed:"right"},{header:s(()=>[o(w,null,{default:s(()=>g[3]||(g[3]=[E("内容")])),_:1,__:[3]})]),default:s(u=>[E(U(u.row.data),1)]),_:1})]),_:1},8,["data","height"])],512)}}}),Ut=X({__name:"AppRun",setup(t){return(d,l)=>{const r=ht,c=vt;return C(),le(c,{class:"h-100%"},{default:s(()=>[o(r,{class:"h-100%",span:14},{default:s(()=>[o(Ht)]),_:1}),o(r,{span:10},{default:s(()=>[o(Mt)]),_:1})]),_:1})}}});export{Ut as default};
